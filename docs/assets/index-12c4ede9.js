import{H as P,W as y}from"./HavokPhysics-7490dd75.js";import{S,C as V,c as J,V as m,T,A as z,P as u,d as Q,g as f,e as F}from"./runBabylonPlaygroundScene-32a4afbd.js";import{D as N}from"./directionalLight-d037032f.js";import{H as U,S as v}from"./linesBuilder-a2dae4c1.js";import{H as E,e as B,f as D}from"./havokPlugin-66927be8.js";import{M as b}from"./meshBuilder-ad173be8.js";import{S as j}from"./sceneLoader-f06775c7.js";import{S as k}from"./shadowGeneratorSceneComponent-1c2fa54e.js";import"./physicsEngineComponent-f32049b7.js";import"./ExtrasAsMetadata-129db08e.js";import"./workerPool-f37bc04e.js";import"./blurPostProcess-f61d1d3e.js";import"./pbrMaterial-34e2fd30.js";import"./animationGroup-a96e107c.js";const L="data:model/gltf-binary;base64,Z2xURgIAAAAoDgAAWAMAAEpTT057ImFzc2V0Ijp7ImdlbmVyYXRvciI6ImdsVEYtVHJhbnNmb3JtIHYzLjQuMCIsInZlcnNpb24iOiIyLjAifSwiYWNjZXNzb3JzIjpbeyJ0eXBlIjoiU0NBTEFSIiwiY29tcG9uZW50VHlwZSI6NTEyMywiY291bnQiOjIwOTR9LHsidHlwZSI6IlZFQzMiLCJjb21wb25lbnRUeXBlIjo1MTI2LCJjb3VudCI6MTI0MiwibWF4IjpbMjAuMDAwMDAxOTA3MzQ4NjMzLDIyLjAwMDg1NDQ5MjE4NzUsMjBdLCJtaW4iOlstMTkuOTk5OTk4MDkyNjUxMzY3LC0xLjU4OTQ1MzQwNDQ0OTE1OTNlLTcsLTIwXX0seyJ0eXBlIjoiVkVDMyIsImNvbXBvbmVudFR5cGUiOjUxMjYsImNvdW50IjoxMjQyfV0sImJ1ZmZlclZpZXdzIjpbeyJidWZmZXIiOjAsImJ5dGVPZmZzZXQiOjAsImJ5dGVMZW5ndGgiOjI3NDB9XSwiYnVmZmVycyI6W3siYnl0ZUxlbmd0aCI6Mjc0MH1dLCJtZXNoZXMiOlt7Im5hbWUiOiJNYXJibGVSdW5CbG9ja3MtU3RyYWlnaHQiLCJwcmltaXRpdmVzIjpbeyJhdHRyaWJ1dGVzIjp7IlBPU0lUSU9OIjoxLCJOT1JNQUwiOjJ9LCJtb2RlIjo0LCJpbmRpY2VzIjowLCJleHRlbnNpb25zIjp7IktIUl9kcmFjb19tZXNoX2NvbXByZXNzaW9uIjp7ImJ1ZmZlclZpZXciOjAsImF0dHJpYnV0ZXMiOnsiUE9TSVRJT04iOjAsIk5PUk1BTCI6MX19fX1dfV0sIm5vZGVzIjpbeyJuYW1lIjoiTWFyYmxlUnVuQmxvY2tzLVN0cmFpZ2h0IiwibWVzaCI6MH1dLCJzY2VuZXMiOlt7Im5hbWUiOiJTY2VuZSIsIm5vZGVzIjpbMF19XSwic2NlbmUiOjAsImV4dGVuc2lvbnNVc2VkIjpbIktIUl9kcmFjb19tZXNoX2NvbXByZXNzaW9uIl0sImV4dGVuc2lvbnNSZXF1aXJlZCI6WyJLSFJfZHJhY29fbWVzaF9jb21wcmVzc2lvbiJdfSAgtAoAAEJJTgBEUkFDTwICAQEAAADfAroF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";function lA(A){const e=new S(A);return O(e),e}async function O(A){const e=q(A);A.clearColor=V.FromHSV(30,.8,1).toColor4(),new J("camera",150/180*Math.PI,45/180*Math.PI,23,new m(0,0,0),A).attachControl();const a=new N("shadowLight",new m(0,-20,10),A);a.autoUpdateExtends=!1,a.shadowMinZ=1,a.shadowMaxZ=30,a.shadowFrustumSize=20,window.shadowLight=a;const t=new k(1024,a);t.darkness=.95,t.useContactHardeningShadow=!0,t.contactHardeningLightSizeUVRatio=.1;var n=new U("ambient light",a.direction,A);n.intensity=.3;function c(){return y}const o=await P({locateFile:c}),I=new E(!0,o);A.enablePhysics(new m(0,-9.8,0),I);const C=H(A);C.receiveShadows=!0,R(A);const d=await j.LoadAssetContainerAsync(L,"",A);console.log("Loaded mesh.",d.meshes[0]);const[s]=d.meshes;function w(l){return l.getClassName()==="Mesh"}if(!w(s)){console.error("The loaded AbstractMesh is not a Mesh, so we can not bake the transform.",s);return}s.scaling.setAll(1/20),s.bakeCurrentTransformIntoVertices(),s.refreshBoundingInfo(),g(new m(0,2,0));for(let l=0;l<10;l++)g(new m(f.RandomRange(-5,5),2+l*3,f.RandomRange(-5,5))),await new Promise(M=>setTimeout(M,250));function g(l){const M=d.instantiateModelsToScene().rootNodes[0],i=M.getChildMeshes()[0];if(!w(M))throw new Error("Cloned root is not a TransformNode.");if(!w(i))throw new Error("Cloned mesh is not a Mesh.");return M.name="marble-piece-root",i.material=e.fromHue(Math.random()),i.position=l,t.addShadowCaster(M,!0),new B(i,D.MESH,{mass:1,mesh:i},A),i.metadata={draggable:!0},M}const h=new T("marblesContainer"),p=setInterval(()=>{const l=G(A,new m(Math.random()*.2-.1,10,Math.random()*.2-.1),e.fromHue(Math.random()));l.parent=h,t.addShadowCaster(l),X(h)},1e3);A.onDisposeObservable.addOnce(()=>clearInterval(p))}function H(A){const e=b.CreateBox("ground",{width:20,depth:20,height:.5},A);return e.position=new m(0,-.25,0),new B(e,D.BOX,{mass:0,restitution:.1},A),e}function G(A,e,r){const a=b.CreateSphere("marble",{diameter:1},A);return a.position=e,a.material=r,new B(a,D.SPHERE,{mass:1,restitution:.25},A),a.metadata={draggable:!0},a}function R(A){const e=b.CreateSphere("from sphere",{diameter:.5},A),r=b.CreateSphere("to sphere",{diameter:.5},A);e.isVisible=!1,r.isVisible=!1;const a=500;function t(n,c){var l,M;if(!((l=n.metadata)!=null&&l.draggable)||!n.physicsBody)return null;const o=n.physicsBody;(M=A.activeCamera)==null||M.detachControl();const I=o.getGravityFactor(),C=o.getLinearDamping(),d=o.getMassProperties(),s=n.absolutePosition.subtract(c).addInPlace(new m(0,2,0));o.setGravityFactor(0),o.setLinearDamping(a),o.setMassProperties({mass:1,inertia:new m(0,0,0)}),e.position.copyFrom(c),r.position.copyFrom(n.getAbsolutePosition());function w(){const i=o.transformNode.absolutePosition.add(o.getMassProperties().centerOfMass),Z=r.position.subtract(i);o.applyForce(Z.scale(a),i)}const g=A.onBeforePhysicsObservable.add(w);function h(i){r.position.copyFrom(i).addInPlace(s)}function p(){var i;A.onBeforePhysicsObservable.remove(g),o.setGravityFactor(I),o.setLinearDamping(C),o.setMassProperties(d),e.isVisible=!1,r.isVisible=!1,(i=A.activeCamera)==null||i.attachControl()}return{onDrag:h,onEnd:p}}return Y(A,t)}function X(A){const e=A.getChildren(r=>r.absolutePosition.y<0);e.length&&(console.debug(`Killing ${e.length} fallen marbles.`,e),e.forEach(r=>{r.parent=null,z.CreateAndStartAnimation("fade out",r,"visibility",1,1,1,0,0,void 0,()=>r.dispose())}))}function Y(A,e){const a=.1*Math.min(A.getEngine().getRenderWidth(),A.getEngine().getRenderHeight());let t=null,n=null;const c=A.onPointerObservable.add(o=>{const I=o.pickInfo,C=I.pickedPoint,d=I.pickedMesh;switch(o.type){case u.POINTERDOWN:if(C&&d){t&&(t.onEnd(),t=null,n=null);const w=e(d,C);if(!w)return;t={startXY:new Q(o.event.clientX,o.event.clientY),startPosition:C,mesh:d,...w},n=null}break;case u.POINTERMOVE:if(!t)return;const s=I.ray;if(s){if(!n){const g=new Q(o.event.clientX,o.event.clientY).subtract(t.startXY);if(g.length()<a)return;const p=g.normalize().y<-.7?new m(-s.direction.x,0,-s.direction.z).normalize():m.UpReadOnly;n=F.FromPositionAndNormal(t.startPosition,p)}const w=s.intersectsPlane(n);if(w!==null){const g=s.origin.add(s.direction.scale(w));t.onDrag(g)}}break;case u.POINTERUP:t&&(t.onEnd(),t=null,n=null);break}});return function(){A.onPointerObservable.remove(c)}}function q(A){const e=new Map;function r(a){const t=V.FromHSV(Math.trunc(a*36)*10,.8,.9),n=t.toHexString();let c=e.get(n);return c||(c=new v(`createMaterialsPool ${n}`,A),c.diffuseColor=t,e.set(n,c)),c}return{fromHue:r}}export{lA as createScene,Y as startCustomDragBehaviour};
