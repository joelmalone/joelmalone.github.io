import{V as r,av as l,a6 as c,S as h,l as _,L as P,O as a,T as y}from"./runBabylonPlaygroundScene-32a4afbd.js";class n{constructor(s,i){this.type=s,this.jointData=i,i.nativeParams=i.nativeParams||{}}get physicsJoint(){return this._physicsJoint}set physicsJoint(s){this._physicsJoint,this._physicsJoint=s}set physicsPlugin(s){this._physicsPlugin=s}executeNativeFunction(s){s(this._physicsPlugin.world,this._physicsJoint)}}n.DistanceJoint=0;n.HingeJoint=1;n.BallAndSocketJoint=2;n.WheelJoint=3;n.SliderJoint=4;n.PrismaticJoint=5;n.UniversalJoint=6;n.Hinge2Joint=n.WheelJoint;n.PointToPointJoint=8;n.SpringJoint=9;n.LockJoint=10;class I extends n{constructor(s){super(n.DistanceJoint,s)}updateDistance(s,i){this._physicsPlugin.updateDistanceJoint(this,s,i)}}class g extends n{constructor(s,i){super(s,i)}setMotor(s,i){this._physicsPlugin.setMotor(this,s||0,i)}setLimit(s,i){this._physicsPlugin.setLimit(this,s,i)}}class S extends g{constructor(s){super(n.HingeJoint,s)}setMotor(s,i){this._physicsPlugin.setMotor(this,s||0,i)}setLimit(s,i){this._physicsPlugin.setLimit(this,s,i)}}class T extends g{constructor(s){super(n.Hinge2Joint,s)}setMotor(s,i,e=0){this._physicsPlugin.setMotor(this,s||0,i,e)}setLimit(s,i,e=0){this._physicsPlugin.setLimit(this,s,i,e)}}class d{constructor(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=r.Zero(),this._hitPointWorld=r.Zero(),this._rayFromWorld=r.Zero(),this._rayToWorld=r.Zero(),this._triangleIndex=-1}get hasHit(){return this._hasHit}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormalWorld}get hitPointWorld(){return this._hitPointWorld}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}get triangleIndex(){return this._triangleIndex}setHitData(s,i,e){this._hasHit=!0,this._hitNormalWorld.set(s.x,s.y,s.z),this._hitPointWorld.set(i.x,i.y,i.z),this._triangleIndex=e??-1}setHitDistance(s){this._hitDistance=s}calculateHitDistance(){this._hitDistance=r.Distance(this._rayFromWorld,this._hitPointWorld)}reset(s=r.Zero(),i=r.Zero()){this._rayFromWorld.copyFrom(s),this._rayToWorld.copyFrom(i),this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld.setAll(0),this._hitPointWorld.setAll(0),this._triangleIndex=-1}}let f=class m{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw l("CannonJSPlugin")}constructor(s,i=m.DefaultPluginFactory()){if(this._physicsPlugin=i,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");s=s||new r(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach(function(s){s.dispose()}),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(s){this._impostors.push(s),s.uniqueId=this._uniqueIdCounter++,s.parent||this._physicsPlugin.generatePhysicsBody(s)}removeImpostor(s){const i=this._impostors.indexOf(s);i>-1&&this._impostors.splice(i,1).length&&this.getPhysicsPlugin().removePhysicsBody(s)}addJoint(s,i,e){const o={mainImpostor:s,connectedImpostor:i,joint:e};e.physicsPlugin=this._physicsPlugin,this._joints.push(o),this._physicsPlugin.generateJoint(o)}removeJoint(s,i,e){const o=this._joints.filter(function(p){return p.connectedImpostor===i&&p.joint===e&&p.mainImpostor===s});o.length&&this._physicsPlugin.removeJoint(o[0])}_step(s){this._impostors.forEach(i=>{i.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(i)}),s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].object===s)return this._impostors[i];return null}getImpostorWithPhysicsBody(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].physicsBody===s)return this._impostors[i];return null}raycast(s,i){return this._physicsPlugin.raycast(s,i)}raycastToRef(s,i,e){return this._physicsPlugin.raycastToRef(s,i,e)}};Object.defineProperty(c.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(t){this._physicsImpostor!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsImpostor&&(this.physicsImpostor.dispose(),this.physicsImpostor=null)})))},enumerable:!0,configurable:!0});c.prototype.getPhysicsImpostor=function(){return this.physicsImpostor};c.prototype.applyImpulse=function(t,s){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(t,s),this):this};c.prototype.setPhysicsLinkWith=function(t,s,i,e){return!this.physicsImpostor||!t.physicsImpostor?this:(this.physicsImpostor.createJoint(t.physicsImpostor,n.HingeJoint,{mainPivot:s,connectedPivot:i,nativeParams:e}),this)};class u{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw l("")}constructor(s,i=u.DefaultPluginFactory()){this._physicsPlugin=i,this._physicsBodies=[],this._subTimeStep=0,s=s||new r(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}_step(s){s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._physicsBodies)}addBody(s){this._physicsBodies.push(s)}removeBody(s){const i=this._physicsBodies.indexOf(s);i>-1&&this._physicsBodies.splice(i,1)}getBodies(){return this._physicsBodies}getPhysicsPlugin(){return this._physicsPlugin}raycastToRef(s,i,e,o){this._physicsPlugin.raycast(s,i,e,o)}raycast(s,i,e){const o=new d;return this._physicsPlugin.raycast(s,i,o,e),o}}h.prototype.getPhysicsEngine=function(){return this._physicsEngine};h.prototype.enablePhysics=function(t=null,s){if(this._physicsEngine)return!0;let i=this._getComponent(_.NAME_PHYSICSENGINE);i||(i=new b(this),this._addComponent(i));try{if(!s||(s==null?void 0:s.getPluginVersion())===1)this._physicsEngine=new f(t,s);else if((s==null?void 0:s.getPluginVersion())===2)this._physicsEngine=new u(t,s);else throw new Error("Unsupported Physics plugin version.");return this._physicsTimeAccumulator=0,!0}catch(e){return P.Error(e.message),!1}};h.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)};h.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0};h.prototype.deleteCompoundImpostor=function(t){const s=t.parts[0].mesh;s.physicsImpostor&&(s.physicsImpostor.dispose(),s.physicsImpostor=null)};h.prototype._advancePhysicsEngineStep=function(t){if(this._physicsEngine){const s=this._physicsEngine.getSubTimeStep();if(s>0)for(this._physicsTimeAccumulator+=t;this._physicsTimeAccumulator>s;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(s/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=s;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class b{constructor(s){this.name=_.NAME_PHYSICSENGINE,this.scene=s,this.scene.onBeforePhysicsObservable=new a,this.scene.onAfterPhysicsObservable=new a,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?this.scene._physicsEngine.getTimeStep()*1e3:1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}Object.defineProperty(y.prototype,"physicsBody",{get:function(){return this._physicsBody},set:function(t){this._physicsBody!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsBody=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsBody&&(this.physicsBody.dispose(),this.physicsBody=null)})))},enumerable:!0,configurable:!0});y.prototype.getPhysicsBody=function(){return this.physicsBody};y.prototype.applyImpulse=function(t,s){if(!this.physicsBody)throw new Error("No Physics Body for TransformNode");return this.physicsBody.applyImpulse(t,s),this};export{I as D,T as H,g as M,d as P,n as a,S as b,f as c,u as d};
