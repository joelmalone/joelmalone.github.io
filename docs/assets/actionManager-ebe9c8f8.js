import{d as k,V as S,C as B,f as I,O as w,R as m,L as C,aY as D,E as G,w as F,q as z,aA as Y}from"./runBabylonPlaygroundScene-32a4afbd.js";class o{constructor(e,t){this.triggerOptions=e,this.onBeforeExecuteObservable=new w,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):e.trigger?this.trigger=e.trigger:this.trigger=e,this._nextActiveAction=this,this._condition=t}_prepare(){}getTriggerParameter(){return this._triggerParameter}setTriggerParameter(e){this._triggerParameter=e}_evaluateConditionForCurrentFrame(){const e=this._condition;if(!e)return!0;const t=this._actionManager.getScene().getRenderId();return e._evaluationId!==t&&(e._evaluationId=t,e._currentResult=e.isValid()),e._currentResult}_executeCurrent(e){this._evaluateConditionForCurrentFrame()&&(this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction())}execute(e){}skipToNextActiveAction(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this}then(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e}_getProperty(e){return this._actionManager._getProperty(e)}_getEffectiveTarget(e,t){return this._actionManager._getEffectiveTarget(e,t)}serialize(e){}_serialize(e,t){const r={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(r),this._condition){const i=this._condition.serialize();return i.children.push(r),t&&t.children.push(i),i}return t&&t.children.push(r),r}}o._SerializeValueAsString=s=>typeof s=="number"?s.toString():typeof s=="boolean"?s?"true":"false":s instanceof k?s.x+", "+s.y:s instanceof S?s.x+", "+s.y+", "+s.z:s instanceof B?s.r+", "+s.g+", "+s.b:s instanceof I?s.r+", "+s.g+", "+s.b+", "+s.a:s;o._GetTargetProperty=s=>({name:"target",targetType:s._isMesh?"MeshProperties":s._isLight?"LightProperties":s._isCamera?"CameraProperties":s._isMaterial?"MaterialProperties":"SceneProperties",value:s._isScene?"Scene":s.name});m("BABYLON.Action",o);class x{constructor(e){this._actionManager=e}isValid(){return!0}_getProperty(e){return this._actionManager._getProperty(e)}_getEffectiveTarget(e,t){return this._actionManager._getEffectiveTarget(e,t)}serialize(){}_serialize(e){return{type:2,children:[],name:e.name,properties:e.properties}}}class h extends x{static get IsEqual(){return h._IsEqual}static get IsDifferent(){return h._IsDifferent}static get IsGreater(){return h._IsGreater}static get IsLesser(){return h._IsLesser}constructor(e,t,r,i,c=h.IsEqual){super(e),this.propertyPath=r,this.value=i,this.operator=c,this._target=t,this._effectiveTarget=this._getEffectiveTarget(t,this.propertyPath),this._property=this._getProperty(this.propertyPath)}isValid(){switch(this.operator){case h.IsGreater:return this._effectiveTarget[this._property]>this.value;case h.IsLesser:return this._effectiveTarget[this._property]<this.value;case h.IsEqual:case h.IsDifferent:{let e;return this.value.equals?e=this.value.equals(this._effectiveTarget[this._property]):e=this.value===this._effectiveTarget[this._property],this.operator===h.IsEqual?e:!e}}return!1}serialize(){return this._serialize({name:"ValueCondition",properties:[o._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:o._SerializeValueAsString(this.value)},{name:"operator",value:h.GetOperatorName(this.operator)}]})}static GetOperatorName(e){switch(e){case h._IsEqual:return"IsEqual";case h._IsDifferent:return"IsDifferent";case h._IsGreater:return"IsGreater";case h._IsLesser:return"IsLesser";default:return""}}}h._IsEqual=0;h._IsDifferent=1;h._IsGreater=2;h._IsLesser=3;class M extends x{constructor(e,t){super(e),this.predicate=t}isValid(){return this.predicate()}}class V extends x{constructor(e,t,r){super(e),this.value=r,this._target=t}isValid(){return this._target.state===this.value}serialize(){return this._serialize({name:"StateCondition",properties:[o._GetTargetProperty(this._target),{name:"value",value:this.value}]})}}m("BABYLON.ValueCondition",h);m("BABYLON.PredicateCondition",M);m("BABYLON.StateCondition",V);class q extends o{constructor(e,t,r,i){super(e,i),this.propertyPath=r,this._target=this._effectiveTarget=t}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)}execute(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]}serialize(e){return super._serialize({name:"SwitchBooleanAction",properties:[o._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},e)}}class R extends o{constructor(e,t,r,i){super(e,i),this.value=r,this._target=t}execute(){this._target.state=this.value}serialize(e){return super._serialize({name:"SetStateAction",properties:[o._GetTargetProperty(this._target),{name:"value",value:this.value}]},e)}}class K extends o{constructor(e,t,r,i,c){super(e,c),this.propertyPath=r,this.value=i,this._target=this._effectiveTarget=t}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)}execute(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)}serialize(e){return super._serialize({name:"SetValueAction",properties:[o._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:o._SerializeValueAsString(this.value)}]},e)}}class U extends o{constructor(e,t,r,i,c){super(e,c),this.propertyPath=r,this.value=i,this._target=this._effectiveTarget=t}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&C.Warn("Warning: IncrementValueAction can only be used with number values")}execute(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)}serialize(e){return super._serialize({name:"IncrementValueAction",properties:[o._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:o._SerializeValueAsString(this.value)}]},e)}}class j extends o{constructor(e,t,r,i,c,P){super(e,P),this.from=r,this.to=i,this.loop=c,this._target=t}_prepare(){}execute(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)}serialize(e){return super._serialize({name:"PlayAnimationAction",properties:[o._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:o._SerializeValueAsString(this.loop)||!1}]},e)}}class W extends o{constructor(e,t,r){super(e,r),this._target=t}_prepare(){}execute(){this._actionManager.getScene().stopAnimation(this._target)}serialize(e){return super._serialize({name:"StopAnimationAction",properties:[o._GetTargetProperty(this._target)]},e)}}class E extends o{constructor(e=0,t){super(e,t)}execute(){}serialize(e){return super._serialize({name:"DoNothingAction",properties:[]},e)}}class H extends o{constructor(e,t,r,i=!0){super(e,r),this.children=t,this.enableChildrenConditions=i}_prepare(){for(let e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()}execute(e){for(const t of this.children)(!this.enableChildrenConditions||t._evaluateConditionForCurrentFrame())&&t.execute(e)}serialize(e){const t=super._serialize({name:"CombineAction",properties:[],combine:[]},e);for(let r=0;r<this.children.length;r++)t.combine.push(this.children[r].serialize(null));return t}}class J extends o{constructor(e,t,r){super(e,r),this.func=t}execute(e){this.func(e)}}class b extends o{constructor(e,t,r,i){super(e,i),this._target=t,this._parent=r}_prepare(){}execute(){if(this._target.parent===this._parent)return;const e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=S.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}serialize(e){return super._serialize({name:"SetParentAction",properties:[o._GetTargetProperty(this._target),o._GetTargetProperty(this._parent)]},e)}}m("BABYLON.SetParentAction",b);m("BABYLON.ExecuteCodeAction",J);m("BABYLON.DoNothingAction",E);m("BABYLON.StopAnimationAction",W);m("BABYLON.PlayAnimationAction",j);m("BABYLON.IncrementValueAction",U);m("BABYLON.SetValueAction",K);m("BABYLON.SetStateAction",R);m("BABYLON.SetParentAction",b);m("BABYLON.SwitchBooleanAction",q);m("BABYLON.CombineAction",H);class n extends D{constructor(e){super(),e=e||G.LastCreatedScene,e&&(this._scene=e,e.actionManagers.push(this))}dispose(){const e=this._scene.actionManagers.indexOf(this);for(let t=0;t<this.actions.length;t++){const r=this.actions[t];n.Triggers[r.trigger]--,n.Triggers[r.trigger]===0&&delete n.Triggers[r.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)}getScene(){return this._scene}hasSpecificTriggers(e){for(let t=0;t<this.actions.length;t++){const r=this.actions[t];if(e.indexOf(r.trigger)>-1)return!0}return!1}hasSpecificTriggers2(e,t){for(let r=0;r<this.actions.length;r++){const i=this.actions[r];if(e==i.trigger||t==i.trigger)return!0}return!1}hasSpecificTrigger(e,t){for(let r=0;r<this.actions.length;r++){const i=this.actions[r];if(i.trigger===e)if(t){if(t(i.getTriggerParameter()))return!0}else return!0}return!1}get hasPointerTriggers(){for(let e=0;e<this.actions.length;e++){const t=this.actions[e];if(t.trigger>=n.OnPickTrigger&&t.trigger<=n.OnPointerOutTrigger)return!0}return!1}get hasPickTriggers(){for(let e=0;e<this.actions.length;e++){const t=this.actions[e];if(t.trigger>=n.OnPickTrigger&&t.trigger<=n.OnPickUpTrigger)return!0}return!1}registerAction(e){return e.trigger===n.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(C.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),this.getScene()._registeredActions++,n.Triggers[e.trigger]?n.Triggers[e.trigger]++:n.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)}unregisterAction(e){const t=this.actions.indexOf(e);return t!==-1?(this.actions.splice(t,1),n.Triggers[e.trigger]-=1,n.Triggers[e.trigger]===0&&delete n.Triggers[e.trigger],e._actionManager=null,this.getScene()._registeredActions--,!0):!1}processTrigger(e,t){for(let r=0;r<this.actions.length;r++){const i=this.actions[r];if(i.trigger===e){if(t&&(e===n.OnKeyUpTrigger||e===n.OnKeyDownTrigger)){const c=i.getTriggerParameter();if(typeof c=="function"){if(!c(t))continue}else if(c&&c!==t.sourceEvent.keyCode){if(!c.toLowerCase)continue;const P=c.toLowerCase();if(P!==t.sourceEvent.key){const A=t.sourceEvent.charCode?t.sourceEvent.charCode:t.sourceEvent.keyCode;if(String.fromCharCode(A).toLowerCase()!==P)continue}}}i._executeCurrent(t)}}}_getEffectiveTarget(e,t){const r=t.split(".");for(let i=0;i<r.length-1;i++)e=e[r[i]];return e}_getProperty(e){const t=e.split(".");return t[t.length-1]}serialize(e){const t={children:new Array,name:e,type:3,properties:new Array};for(let r=0;r<this.actions.length;r++){const i={type:0,children:new Array,name:n.GetTriggerName(this.actions[r].trigger),properties:new Array},c=this.actions[r].triggerOptions;if(c&&typeof c!="number")if(c.parameter instanceof Node)i.properties.push(o._GetTargetProperty(c.parameter));else if(typeof c.parameter=="object"){const P={};F.DeepCopy(c.parameter,P,["mesh"]),c.parameter&&c.parameter.mesh&&(P._meshId=c.parameter.mesh.id),i.properties.push({name:"parameter",targetType:null,value:P})}else i.properties.push({name:"parameter",targetType:null,value:c.parameter});this.actions[r].serialize(i),t.children.push(i)}return t}static Parse(e,t,r){const i=new n(r);t===null?r.actionManager=i:t.actionManager=i;const c=(g,_)=>{const a=Y("BABYLON."+g);return a&&new a(..._)},P=(g,_,a,f)=>{if(f===null){const y=parseFloat(_);return _==="true"||_==="false"?_==="true":isNaN(y)?_:y}const T=f.split("."),l=_.split(",");for(let y=0;y<T.length;y++)a=a[T[y]];if(typeof a=="boolean")return l[0]==="true";if(typeof a=="string")return l[0];const d=new Array;for(let y=0;y<l.length;y++)d.push(parseFloat(l[y]));return a instanceof S?S.FromArray(d):a instanceof z?z.FromArray(d):a instanceof B?B.FromArray(d):a instanceof I?I.FromArray(d):parseFloat(l[0])},A=(g,_,a,f,T=null)=>{if(g.detached)return;const l=new Array;let d=null,y=null;const L=g.combine&&g.combine.length>0;if(g.type===2?l.push(i):l.push(_),L){const u=new Array;for(let p=0;p<g.combine.length;p++)A(g.combine[p],n.NothingTrigger,a,f,u);l.push(u)}else for(let u=0;u<g.properties.length;u++){let p=g.properties[u].value;const O=g.properties[u].name,N=g.properties[u].targetType;O==="target"?N==="SceneProperties"?p=d=r:N==="MaterialProperties"?p=d=r.getMaterialByName(p):p=d=r.getNodeByName(p):O==="parent"?p=r.getNodeByName(p):O==="sound"?r.getSoundByName&&(p=r.getSoundByName(p)):O!=="propertyPath"?g.type===2&&O==="operator"?p=h[p]:p=P(O,p,d,O==="value"?y:null):y=p,l.push(p)}if(T===null?l.push(a):l.push(null),g.name==="InterpolateValueAction"){const u=l[l.length-2];l[l.length-1]=u,l[l.length-2]=a}let v=c(g.name,l);if(v instanceof x&&a!==null){const u=new E(_,a);f?f.then(u):i.registerAction(u),f=u}T===null?v instanceof x?(a=v,v=f):(a=null,f?f.then(v):i.registerAction(v)):T.push(v);for(let u=0;u<g.children.length;u++)A(g.children[u],_,a,v,null)};for(let g=0;g<e.children.length;g++){let _;const a=e.children[g];if(a.properties.length>0){const f=a.properties[0].value,T=a.properties[0].targetType===null?f:r.getMeshByName(f);T._meshId&&(T.mesh=r.getMeshById(T._meshId)),_={trigger:n[a.name],parameter:T}}else _=n[a.name];for(let f=0;f<a.children.length;f++)a.detached||A(a.children[f],_,null,null)}}static GetTriggerName(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnDoublePickTrigger";case 7:return"OnPickUpTrigger";case 8:return"OnLongPressTrigger";case 9:return"OnPointerOverTrigger";case 10:return"OnPointerOutTrigger";case 11:return"OnEveryFrameTrigger";case 12:return"OnIntersectionEnterTrigger";case 13:return"OnIntersectionExitTrigger";case 14:return"OnKeyDownTrigger";case 15:return"OnKeyUpTrigger";case 16:return"OnPickOutTrigger";default:return""}}}n.NothingTrigger=0;n.OnPickTrigger=1;n.OnLeftPickTrigger=2;n.OnRightPickTrigger=3;n.OnCenterPickTrigger=4;n.OnPickDownTrigger=5;n.OnDoublePickTrigger=6;n.OnPickUpTrigger=7;n.OnPickOutTrigger=16;n.OnLongPressTrigger=8;n.OnPointerOverTrigger=9;n.OnPointerOutTrigger=10;n.OnEveryFrameTrigger=11;n.OnIntersectionEnterTrigger=12;n.OnIntersectionExitTrigger=13;n.OnKeyDownTrigger=14;n.OnKeyUpTrigger=15;export{n as A,H as C,E as D,J as E,U as I,j as P,b as S,h as V,o as a,x as b,M as c,R as d,K as e,V as f,W as g,q as h};
